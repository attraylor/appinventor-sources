#|
$Source $Yail
|#

(define-form fakepackagename Screen1)
(require <com.google.youngandroid.runtime>)

(def (p$MoveMole )  (call-component-method "Form" 'Mole 'MoveTo (*list-for-runtime* (call-yail-primitive "Form" * (*list-for-runtime* (call-yail-primitive "Form" random-fraction (*list-for-runtime*) '() "random fraction") (call-yail-primitive "Form" - (*list-for-runtime* (get-property "Form" 'MyCanvas 'Width) (get-property "Form" 'Mole 'Width)) '(number number) "-") ) '(number number ) "*")  (call-yail-primitive "Form" * (*list-for-runtime* (call-yail-primitive "Form" random-fraction (*list-for-runtime*) '() "random fraction") (call-yail-primitive "Form" - (*list-for-runtime* (get-property "Form" 'MyCanvas 'Height) (get-property "Form" 'Mole 'Height)) '(number number) "-") ) '(number number ) "*")) '(number number)))
(def g$score 0)
(def (p$UpdateScore )  (set-and-coerce-property! "Form" 'ScoreLabel 'Text (call-yail-primitive "Form" string-append (*list-for-runtime* "Score:" (get-var "Form" g$score) ) '(text text ) "join") 'text))
;;; Screen1

(do-after-form-creation (set-and-coerce-property! "Form" 'Screen1 'Title "Screen1" 'text)
)

;;; MyCanvas

(add-component Screen1 Canvas MyCanvas 
(set-and-coerce-property! "Form" 'MyCanvas 'Width -2 'number)

(set-and-coerce-property! "Form" 'MyCanvas 'Height 300 'number)

)

;;; Mole

(add-component MyCanvas ImageSprite Mole 
(set-and-coerce-property! "Form" 'Mole 'Interval 600 'number)

(set-and-coerce-property! "Form" 'Mole 'Picture "mole.png" 'text)

(set-and-coerce-property! "Form" 'Mole 'X 100 'number)

(set-and-coerce-property! "Form" 'Mole 'Y 100 'number)

)

(define-event Mole Touched($x $y)(set-this-form)
    (set-var! "Form" g$score (call-yail-primitive "Form" + (*list-for-runtime* (get-var "Form" g$score) 1 ) '(number number ) "+"))(call-component-method "Form" 'Noise 'Vibrate (*list-for-runtime* 100) '(number))((get-var "Form" p$UpdateScore) )((get-var "Form" p$MoveMole) ))
;;; ScoreLabel

(add-component Screen1 Label ScoreLabel 
(set-and-coerce-property! "Form" 'ScoreLabel 'Text "..." 'text)

)

;;; ResetButton

(add-component Screen1 Button ResetButton 
(set-and-coerce-property! "Form" 'ResetButton 'Text "Reset" 'text)

)

(define-event ResetButton Click()(set-this-form)
    (set-var! "Form" g$score 0)((get-var "Form" p$UpdateScore) ))
;;; Noise

(add-component Screen1 Sound Noise 
)

;;; MoleTimer

(add-component Screen1 Clock MoleTimer 
(set-and-coerce-property! "Form" 'MoleTimer 'TimerInterval 500 'number)

)

(define-event MoleTimer Timer()(set-this-form)
    ((get-var "Form" p$MoveMole) ))
(init-runtime)

